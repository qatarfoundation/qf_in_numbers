!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).bundle={})}(this,(function(e){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function o(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function n(e,r,t){return r&&o(e.prototype,r),t&&o(e,t),e}function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function c(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?s(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function i(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&l(e,r)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,r){return(l=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}function d(e,r){return!r||"object"!=typeof r&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):r}function h(e){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,o=u(e);if(r){var n=u(this).constructor;t=Reflect.construct(o,arguments,n)}else t=o.apply(this,arguments);return d(this,t)}}var f=function(){function e(){t(this,e)}return n(e,[{key:"addEventListener",value:function(e,r){void 0===this._listeners&&(this._listeners={});var t=this._listeners;void 0===t[e]&&(t[e]=[]),t[e].includes(r)||t[e].push(r)}},{key:"removeEventListener",value:function(e,r){if(void 0!==this._listeners){var t=this._listeners[e];if(void 0!==t){var o=t.indexOf(r);-1!==o&&t.splice(o,1)}}}},{key:"dispatchEvent",value:function(e,r){if(void 0!==this._listeners){var t=this._listeners[e];if(void 0!==t)for(var o=t.slice(0),n=0,a=o.length;n<a;n++)o[n].call(this,r)}}}]),e}();function p(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];if(t.length<2||"object"!==r(t[0]))throw new Error("Function expects object, method, method etc.");for(var n=t.shift(),a=t,s=0,c=a.length;s<c;s++){var i=a[s];n[i]=n[i].bind(n)}}var v=function(e){i(o,e);var r=h(o);function o(){var e;return t(this,o),(e=r.call(this))._progress=0,e._resourcesToPreload=[],e._preloadedResources=0,e._bindAll(),e}return n(o,[{key:"add",value:function(e){for(var r=e.resources,t=e.namespace,n=e.preload,a=0;a<r.length;a++){var s=Object.assign({},r[a]);t&&(s.namespace&&console.warn('Resource Loader: resource namespace "'.concat(s.namespace,'" will override the original name space for resource "').concat(s.name,'"')),s.namespace=t),void 0!==n&&void 0===s.preload&&(s.preload=n),void 0===s.preload&&(s.preload=o.preloadByDefault),o.resources.push(s)}return o.resources}},{key:"preload",value:function(){var e=[],r=o.resources.filter((function(e){return e.preload}));this._preloadStartHandler(r);for(var t=0,n=r.length;t<n;t++){var a=o.loadResource(r[t]);e.push(a),a.then(this._preloadProgressHandler)}return Promise.all(e).then(this._preloadCompleteHandler,this._preloadErrorHandler)}},{key:"destroy",value:function(){o.cache=[],o.loaders={},o.resources=[],this._progress=null,this._resourcesToPreload=null,this._preloadedResources=null}},{key:"_bindAll",value:function(){p(this,"_preloadCompleteHandler","_preloadProgressHandler","_preloadErrorHandler")}},{key:"_preloadStartHandler",value:function(e){this._resourcesToPreload=e,this.dispatchEvent("start",this._resourcesToPreload)}},{key:"_preloadProgressHandler",value:function(e){this._preloadedResources++,this._progress=this._preloadedResources/this._resourcesToPreload.length,this.dispatchEvent("progress",this._progress)}},{key:"_preloadCompleteHandler",value:function(e){this.dispatchEvent("complete",e)}},{key:"_preloadErrorHandler",value:function(){console.error("Resource Loader : Something went wrong while preloading resources")}}],[{key:"clearResources",value:function(){o.cache=[],o.resources=[]}},{key:"load",value:function(e){return this.loadResourceByName(e.name,e.path)}},{key:"get",value:function(e){return this.getResourceByName(e).data}},{key:"registerLoader",value:function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.loaders[r]=new e(c({type:r},t))}},{key:"getLoader",value:function(e){if(!this.loaders[e])throw new Error('Resource Loader: No loader is available for type "'.concat(e,'"'));return this.loaders[e]}},{key:"registerWorker",value:function(e){this.worker=e}},{key:"loadResourceByName",value:function(e,r){var t=this;return new Promise((function(o,n){for(var a=0,s=t.cache.length;a<s;a++)if(t.cache[a].path===r)return void o(t.cache[a].data);for(var c=null,i=0;i<t.resources.length;i++)t.resources[i].name===e&&(c=t.resources[i]);c||n(new Error("Resource Loader: Resource with name '".concat(e,"' was not found"))),t.loadResource(c).then((function(){o(c.data)}),(function(){n(new Error('Resource Loader : failing to get the resource "'.concat(e,'"')))}))}))}},{key:"getResourceByName",value:function(e){for(var r=0,t=this.cache.length;r<t;r++)if(this.cache[r].name===e)return this.cache[r];throw new Error("Resource Loader: Resource with name '".concat(e,"' was not found"))}},{key:"loadResource",value:function(e){var r=this;if(!e.name)throw new Error("Resource name should be defined");var t=this.loaders[e.type];if(!t)throw new Error('Resource Loader: No loader is available for type "'.concat(e.type,'"'));if(!e.path)throw new Error('Resource Loader: Could not find resource path for "'.concat(e.name,'"'));var o=this.resolvePath(e.path),n=t.load({path:o,name:e.name,type:e.type,basePath:this.basePath,options:e.options});return n.then((function(t){e.data=t;for(var o=0,n=r.cache.length;o<n;o++)if(r.cache[o].name===e.name)return;r.cache.push(e)})),n}},{key:"resolvePath",value:function(e){return function(e){return new RegExp("^(?:[a-z]+:)?//","i").test(e)}(e)?e:"".concat(this.basePath).concat(e)}},{key:"isResourceAdded",value:function(e){for(var r=0;r<o.resources.length;r++)if(o.resources[r].type===e.type&&(o.resources[r].name===e.name||o.resources[r].path===e.path))return!0}}]),o}(f);a(v,"resources",[]),a(v,"cache",[]),a(v,"basePath",""),a(v,"loaders",{}),a(v,"worker",null),a(v,"preloadByDefault",!1);var y=function(e){i(o,e);var r=h(o);function o(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,o),(e=r.call(this))._progress=0,e._preloadedResources=0,e._isComplete=!1,e._name=n.name,e._namespace=n.namespace,e._resources=e._setupResources(),e._bindAll(),e}return n(o,[{key:"resources",get:function(){return this._resources}},{key:"isComplete",get:function(){return this._isComplete}},{key:"get",value:function(e){for(var r=0;r<this._resources.length;r++)if(this._resources[r].name===e)return this._resources[r].data;console.error('Resource manager "'.concat(this._namespace,'" : Couln\'t find resource with name "').concat(e,'"'))}},{key:"add",value:function(e){Array.isArray(e)?this._addMultiple(e):this._isResourceAdded(e)?console.warn('Resource manager "'.concat(this._namespace,'" : Resource with same name or path has already been added for "').concat(e.name,'"')):(this._resources.push(e),v.resources.push(e))}},{key:"addByName",value:function(e){if(Array.isArray(e))this._addByNames(e);else{for(var r=null,t=0;t<v.resources.length;t++){var o=v.resources[t];if(e===o.name){if(!this._isResourceAdded(o))return this._resources.push(o),void(r=o);console.warn('Resource manager "'.concat(this._namespace,'" : Resource with name "').concat(o.name,'" has already been added')),r=void 0}}null===r&&console.warn('Resource manager "'.concat(this._namespace,'" : Could not find any resource with name "').concat(e,'"'))}}},{key:"load",value:function(){var e=[];this._preloadStartHandler();for(var r=0;r<this._resources.length;r++){var t=this._resources[r],o=v.load(t);o.then(this._preloadProgressHandler,this._preloadErrorHandler),e.push(o)}return Promise.all(e).then(this._preloadCompleteHandler)}},{key:"destroy",value:function(){this._progress=null,this._preloadedResources=null,this._name=null,this._namespace=null,this._resources=null}},{key:"_setupResources",value:function(){for(var e=[],r=0;r<v.resources.length;r++){var t=v.resources[r];(void 0!==t.namespace&&t.namespace===this._namespace||void 0===this._namespace&&t.preload)&&e.push(t)}return e}},{key:"_addMultiple",value:function(e){for(var r=0;r<e.length;r++){var t=e[r];if(this._isResourceAdded(t))return void console.warn('Resource manager "'.concat(this._namespace,'" : Resource with same name or path has already been added for "').concat(t.name,'"'));this._resources.push(t),v.resources.push(t)}}},{key:"_addByNames",value:function(e){for(var r=0;r<v.resources.length;r++){var t=v.resources[r];if(e.includes(t.name))if(this._isResourceAdded(t)){console.warn('Resource manager "'.concat(this._namespace,'" : Resource with same name or path has already been added for "').concat(t.name,'"'));var o=e.indexOf(t.name);e.splice(o,1)}else{this._resources.push(t);var n=e.indexOf(t.name);e.splice(n,1)}}e.length>0&&console.warn('Resource manager "'.concat(this._namespace,'" : Could not find any resource with following name(s) : ').concat(e.join(", ")))}},{key:"_bindAll",value:function(){p(this,"_preloadCompleteHandler","_preloadErrorHandler","_preloadProgressHandler")}},{key:"_preloadStartHandler",value:function(){this.dispatchEvent("start",null)}},{key:"_preloadProgressHandler",value:function(e){this._preloadedResources++,this._progress=this._preloadedResources/this._resources.length,this.dispatchEvent("progress",this._progress)}},{key:"_preloadCompleteHandler",value:function(e){this._isComplete=!0,this.dispatchEvent("complete",e)}},{key:"_preloadErrorHandler",value:function(){console.error("Resource manager ".concat(this._namespace," : something went wrong while preloading resources"))}},{key:"_isResourceAdded",value:function(e){for(var r=0;r<this._resources.length;r++)if(this._resources[r].type===e.type&&(this._resources[r].name===e.name||this._resources[r].path===e.path))return!0}}]),o}(f),m=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),this.type=r.type}return n(e,[{key:"worker",get:function(){return v.worker}},{key:"load",value:function(e){return new Promise}}]),e}();e.Loader=m,e.ResourceLoader=v,e.ResourceManager=y,e.default=v,Object.defineProperty(e,"__esModule",{value:!0})}));
